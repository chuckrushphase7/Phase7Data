<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Latitude Margaritaville Hilton Head</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Detect Android WebView mode early to avoid flicker -->
  <script>
    (function () {
      if (window.location.search.indexOf("android=1") !== -1) {
        document.documentElement.classList.add("android-app");
      }
    })();
  </script>

  <style>
  * { box-sizing: border-box; }

  html, body { margin: 0; overflow-x: hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

  /* ---------- FIXED HEADER ---------- */
  header.top-bar{
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 5000;
    background:#111827;
    color:#f9fafb;
    padding: 10px 12px 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,.18);
  }

  header.top-bar .row0.dev-title{
    text-align:center;
    font-weight:800;
    font-size:0.95rem;
    line-height:1.15;
    padding: 0 8px 6px;
  }

  header.top-bar .row1{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }

  header.top-bar .app-title{
    font-weight:800;
    font-size:1.05rem;
    white-space:nowrap;
  }

  header.top-bar .top-controls{
    display:flex;
    align-items:center;
    gap:10px;
    font-size:.9rem;
    flex-wrap:wrap;
    justify-content:flex-end;
  }

  label.season-toggle{
    display:inline-flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
    user-select:none;
  }

  input[type="checkbox"]{ transform: scale(1.1); }

  .link-button{
    background:none;
    border:none;
    color:#93c5fd;
    text-decoration: underline;
    cursor:pointer;
    font-size:0.8rem;
    padding:2px 4px;
  }

  /* Optional status row (kept hidden by default, see HTML) */
  header.top-bar .status-row{
    margin-top:6px;
    display:flex;
    justify-content:center;
  }

  header.top-bar .status-text{
    pointer-events:none; /* IMPORTANT: don't block canvas taps */
    display:inline-block;
    text-align:center;
    font-weight:800;
    padding:4px 10px;
    border-radius:999px;
    background:#065f46;
    border:1px solid #34d399;
    color:#ecfdf5;
    max-width:95vw;
    white-space:normal;
    font-size:.78rem;
    line-height:1.1;
  }

  @media (max-width: 520px){
    header.top-bar{ padding: 10px 10px 8px; }
    header.top-bar .row0.dev-title{ font-size:0.92rem; }
    header.top-bar .top-controls{ gap:8px; font-size:.88rem; }
  }

  /* Push content below fixed header */
  body{ padding-top: 118px; } /* keep this since you have a 2-line header */

  /* ---------- MAIN LAYOUT ---------- */
  main{
    flex: 1;
    display:flex;
    flex-direction:column;
    padding: 8px;
    gap: 8px;
    scroll-margin-top: 70px;
  }

  /* ---------- MAP WRAPPER ---------- */
  .map-shell { text-align: center; }
.map-shell .map-wrapper { text-align: left; }
.map-wrapper{
  position: relative;
  display: inline-block;           /* key: shrink-wrap to canvas width */
  max-width: 100%;                 /* still responsive on small screens */
  overflow: auto;
  -webkit-overflow-scrolling: touch;

  background: #e5e7eb;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  margin: 0 auto;
}


  /* Canvas uses intrinsic size; wrapper scrolls */
/* Canvas uses intrinsic size; wrapper scrolls */
#mapCanvas{
  display: block;
  width: auto;
  height: auto;
  max-width: none;
  position: relative;
  z-index: 1;
}

/* Sprite overlay must never steal taps */
#mapWrapper{ position: relative; z-index: 0; }


#spriteLayer{
  position: absolute;
  left: 0;
  top: 0;
  width: 1500px;
  height: 1500px;
  pointer-events: none;
  z-index: 9999;     /* force top */
}
@keyframes gatorWiggle {
  0%, 100% { transform: translate(-50%, -50%) rotate(-6deg); }
  50%      { transform: translate(-50%, -50%) rotate(6deg); }
}


.alligator-sprite{
  position: absolute;
  z-index: 6;
  transform: translate(-50%, -50%);
  opacity: 1 !important;
  filter: none !important;
  text-shadow: 0 0 3px #fff, 0 0 6px #fff;
  animation: gatorWiggle 1.2s ease-in-out infinite;

}
.santa-sprite{
  position: absolute;
  width: 90px;              /* tweak */
  height: auto;
  transform: translate(-50%, -50%);
  z-index: 20;
  pointer-events: none;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,.35));
}





  /* ---------- DOWNLOAD BAR ---------- */
  #download-bar{
    margin: 10px 0;
    text-align:center;
  }

  #apkMeta{
    margin-top: 6px;
    font-size: 0.75rem;
    color: #374151;
  }

  /* ---------- POPUP (mobile-friendly fixed sheet) ---------- */
  #lotPopup{
    position: fixed;          /* stays visible even while map scrolls */
    left: 50%;
    bottom: 14px;
    transform: translateX(-50%);
    z-index: 6000;

    width: min(92vw, 380px);
    max-height: 55vh;
    overflow-y: auto;

    background:#fff;
    border:1px solid #d1d5db;
    border-radius: 10px;
    box-shadow: 0 12px 22px rgba(0,0,0,.22);
    padding: 10px 12px;
  }

  #lotPopup.hidden{ display:none !important; }

  @media (max-width: 520px){
    #lotPopup{
      bottom: 12px !important;
      max-height: 45vh;
      font-size: 0.75rem;
    }
    #lotPopup h3{ font-size: 0.85rem; }
  }

  #lotPopup h3{ margin: 0 0 4px 0; font-size: 0.9rem; }
  .popup-close{ margin-top: 6px; font-size: 0.75rem; padding: 2px 6px; }
  .popup-inner p{ margin: 2px 0; }

  /* ---------- PRIVACY MODAL ---------- */
  .privacy-panel{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.6);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index: 1000;
  }

  .privacy-panel.hidden{ display:none; }

  .privacy-content{
    background:#fff;
    max-width:600px;
    width:90%;
    padding: 16px 20px;
    border-radius: 8px;
    max-height: 80vh;
    overflow-y: auto;
    font-size: 0.9rem;
  }

  .privacy-content h2{ margin-top:0; margin-bottom:8px; }
  .privacy-content ul{ padding-left:20px; }
  .privacy-content button{ margin-top:12px; padding:4px 10px; font-size:0.85rem; }

  /* ---------- FOOTER ---------- */
  footer{
    padding: 6px 10px;
    font-size: 0.75rem;
    text-align: center;
    color: #6b7280;
  }

  /* ---------- ANDROID APP LAYOUT TWEAKS ---------- */
  .android-app #download-bar,
  .android-app #android-instructions,
  .android-app #ios-instructions{
    display:none !important;
  }
</style>

</head>

<body>
<header class="top-bar">
  <div class="row0 dev-title">Latitude Margaritaville Hilton Head</div>

  <div class="row1">
    <div class="app-title">Phase 7</div>

    <div class="top-controls">
      <label class="season-toggle">
        <input type="checkbox" id="seasonOnlyCheckbox" />
        <span id="seasonOnlyLabel">Residents</span>
      </label>
      <button id="privacyButton" class="link-button">Privacy</button>
    </div>
  </div>

  <!-- Optional status row; keep, but don't duplicate the title -->
 <div class="row2 status-row">
  <span id="lockStatus" class="status-text" style="display:none;"></span>
 </div>
</header>




  <!-- Download buttons (hidden in Android app via .android-app class) -->
  <div id="download-bar">
    <a
      id="apkDownloadButton"
      href="https://github.com/chuckrushphase7/Phase7Data/releases/download/v1.0.0/Phase7Residents.apk"
      style="
        padding: 8px 16px;
        border-radius: 999px;
        border: 1px solid #2563eb;
        background: #2563eb;
        color: white;
        font-size: 0.9rem;
        cursor: pointer;
        margin-right: 8px;
        text-decoration: none;
        display: inline-block;
      ">
      Download Android App
    </a>

    <button
      onclick="document.getElementById('ios-instructions')?.scrollIntoView({ behavior: 'smooth' });"
      style="
        padding: 8px 16px;
        border-radius: 999px;
        border: 1px solid #6b7280;
        background: white;
        color: #374151;
        font-size: 0.9rem;
        cursor: pointer;
      ">
      iPhone / iPad Instructions
    </button>

    <div id="apkMeta">
      <span style="opacity:0.9;">Latest Android build:</span>
      <strong id="apkBuildLabel">Loading...</strong>
    </div>
  </div>

  <main>

<div class="map-shell">
  <div class="map-wrapper" id="mapWrapper">
    <canvas id="mapCanvas"></canvas>
    <div id="lotPopup" class="hidden"></div>
    <div id="spriteLayer"></div>
  </div>
</div>


    <!-- Android install instructions (hidden in Android app) -->
    <section id="android-instructions" style="margin: 20px auto; max-width: 600px; padding: 12px 16px; border-top: 1px solid #e5e7eb;">
      <h2 style="font-size: 1.1rem; margin-bottom: 8px; text-align: center;">
        Installing the Android App
      </h2>

      <p style="font-size: 0.9rem; margin-bottom: 6px;">
        The Android version of the Phase 7 Neighborhood Map is installed from an <code>.apk</code> file.
        Follow these steps on your Android phone or tablet:
      </p>

      <ol style="font-size: 0.88rem; padding-left: 20px; line-height: 1.4;">
        <li>Tap the <strong>Download Android App</strong> button above.</li>
        <li>Your browser may warn that this type of file can harm your device. This is a standard warning for apps installed from outside the Play Store.</li>
        <li>Tap <strong>Download</strong> or <strong>Download anyway</strong> to continue.</li>
        <li>When the download finishes, tap the notification, or open your <strong>Downloads</strong> app and select <code>Phase7Residents.apk</code>.</li>
        <li>If prompted, allow your browser or file manager to install apps from this source.</li>
        <li>Tap <strong>Install</strong>, then <strong>Open</strong> to launch the Phase 7 app.</li>
      </ol>

      <p style="font-size: 0.85rem; margin-top: 8px; color: #444;">
        After installation, you can open the Phase 7 app from your home screen like any other app.
      </p>
    </section>

    <!-- iOS instructions (hidden in Android app) -->
    <section id="ios-instructions" style="margin: 20px auto; max-width: 600px; padding: 12px 16px; border-top: 1px solid #e5e7eb;">
      <h2 style="font-size: 1.1rem; margin-bottom: 8px; text-align: center;">
        Using Phase 7 on iPhone / iPad
      </h2>

      <p style="font-size: 0.9rem; margin-bottom: 6px;">
        The Phase 7 Neighborhood Map runs as a mobile website on Apple devices. You can add it to your Home Screen so it behaves just like an app:
      </p>

      <ol style="font-size: 0.88rem; padding-left: 20px; line-height: 1.4%;">
        <li>Open this page in Safari on your iPhone or iPad.</li>
        <li>Tap the <strong>Share</strong> icon (square with an arrow).</li>
        <li>Scroll down and choose <strong>Add to Home Screen</strong>.</li>
        <li>Enter a name like <em>Phase 7 Map</em> and tap <strong>Add</strong>.</li>
      </ol>

      <p style="font-size: 0.85rem; margin-top: 8px; color: #444;">
        Once added, it will open full-screen with its own icon just like a native app.
      </p>
    </section>
  </main>

  <!-- Admin / Debug Panel (visible with ?admin=1) -->
  <section id="admin-panel" style="display:none; margin: 20px auto; max-width: 800px; padding: 12px 16px; border-top: 1px solid #e5e7eb;">
    <h2 style="font-size: 1.05rem; margin-bottom: 8px; text-align: center;">
      Admin / Debug View
    </h2>
    <p style="font-size: 0.85rem; color: #555; text-align: center;">
      This panel appears only when the URL includes <code>?admin=1</code>.
    </p>

    <div id="admin-summary" style="font-size: 0.85rem; margin-bottom: 10px;"></div>

    <label for="admin-events-json" style="font-size: 0.8rem; font-weight: 600; display:block; margin: 8px 0 4px;">
      EVENTS JSON (read-only)
    </label>
    <textarea
      id="admin-events-json"
      readonly
      style="width: 100%; height: 220px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 0.8rem; padding: 6px; border-radius: 4px; border: 1px solid #d1d5db; background: #f9fafb;"></textarea>
  </section>

  <footer>
    This map is for Phase 7 residents. Seasonal view hides personal information by default.
  </footer>

  <!-- Privacy modal -->
  <div id="privacyPanel" class="privacy-panel hidden">
    <div class="privacy-content">
      <h2>Privacy &amp; Data Use</h2>
      <p>
        This map is provided for residents of Phase 7 for neighborhood reference and seasonal displays.
        It does not send or share your data with any online service.
      </p>
      <ul>
        <li>By default, the map only shows seasonal stations (like <em>Holiday Season</em> displays).</li>
        <li>Names, addresses, phone numbers, and other personal details are hidden in the default view.</li>
        <li>Full resident information is only shown after entering a password, intended for internal community use.</li>
        <li>Certain homes may be flagged as sensitive, and their details are limited even in the unlocked view.</li>
      </ul>
      <p>
        If you have questions or want your information removed or changed, please contact the Phase 7 coordinators.
      </p>
      <button id="privacyCloseButton">Close</button>
    </div>
  </div>

  <!-- Data and logic files -->
  <script src="phase7_merged_lots.js"></script>
  <script src="mapped_sites.js"></script>
  <script src="apk_info.js"></script>
  <script src="events.js"></script>
  <script src="draw_sites.js"></script>
  <script src="event_engine.js"></script>
  <script src="draw_lots.js"></script>
  <script src="map_core.js"></script>

  <!-- Populate APK build label -->
  <script>
    (function () {
      var el = document.getElementById("apkBuildLabel");
      if (!el) return;

      if (typeof apkInfo !== "undefined" && apkInfo && apkInfo.buildDate) {
        var tag = apkInfo.tag ? (" (" + apkInfo.tag + ")") : "";
        el.textContent = apkInfo.buildDate + tag;
      } else {
        el.textContent = "Unknown";
      }
    })();
  </script>
</body>
</html>
